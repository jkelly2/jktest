This is the super main function.  There may be a slight mistake contained within it.
Other than that, it's brilliant.